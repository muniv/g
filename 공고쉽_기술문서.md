# 공고쉽(GongoShip) 프로젝트 기술 문서

## 프로젝트 개요

**공고쉽(GongoShip)**은 "공고를 쉽게"라는 의미로, 복잡한 공고 문서를 AI를 활용하여 이해하기 쉽게 변환해주는 웹 애플리케이션입니다. 사용자가 업로드한 문서나 링크를 분석하여 자동으로 FAQ를 생성하고, 스마트 AI 챗봇을 통해 문서 내용에 대한 질의응답을 제공합니다.

## 1. 사용한 기술 스택

### 프론트엔드 기술들

**핵심 프레임워크 및 라이브러리**
- **React 19.1.1**: 최신 버전의 React를 사용한 컴포넌트 기반 UI 개발
- **TypeScript 4.9.5**: 타입 안전성을 보장하는 정적 타입 언어
- **React Router DOM 7.8.2**: SPA 라우팅 관리

**UI 라이브러리 및 컴포넌트**
- **Lucide React 0.542.0**: 다양한 아이콘 제공
  - 사용된 주요 아이콘: `Upload`, `Eye`, `FileText`, `Loader2`, `X`, `AlertCircle`, `CheckCircle`, `Link`, `Search`, `ArrowLeft`, `MessageCircle`, `HelpCircle`, `Send`

### 라우팅 및 상태 관리

**라우팅 구조**
```typescript
// App.tsx에서 정의된 라우트
<Routes>
  <Route path="/" element={<HomePage />} />
  <Route path="/detail/:id" element={<DetailPage />} />
</Routes>
```

**상태 관리 방식**
- **로컬 상태**: React의 `useState`, `useEffect` 훅 사용
- **데이터 영속성**: `localStorage`를 활용한 클라이언트 사이드 데이터 저장
- **전역 상태**: Context API 대신 Props와 로컬 스토리지로 데이터 공유

### 스타일링 방식

**CSS 아키텍처**
- **모듈 방식**: 각 컴포넌트별 독립적인 CSS 파일
  - `HomePage.css`: 메인 페이지 스타일
  - `DetailPage.css`: 상세 페이지 스타일
  - `App.css`: 전역 스타일 및 애니메이션
  - `index.css`: 기본 CSS 설정

**스타일링 특징**
- **반응형 디자인**: 모바일 우선 반응형 레이아웃
- **사용자 경험 최적화**: 드래그 앤 드롭, 로딩 상태, 진행률 표시
- **접근성**: 키보드 내비게이션, 포커스 관리
- **다크/라이트 테마**: 환경 설정에서 지원 준비

## 2. 데이터 및 AI 모델 연계 방식

### API 엔드포인트 구조

**백엔드 서버 구성**
```typescript
// api.ts에서 정의된 API 서버 (프록시를 통해 접근)
const API_BASE_URL_KINTEL = '/api/kintel';    // K-Intelligence 서버 (localhost:51037)
const API_BASE_URL_MODELS = '/api/models';     // AI 모델 서버 (localhost:51036)
```

**주요 API 엔드포인트**
- `POST /parse-document/`: PDF, DOC, DOCX 문서 파싱
- `POST /parse-document-hwp/`: HWP 파일 전용 파싱
- `POST /parse-document-from-url/`: 웹 URL 콘텐츠 파싱
- `POST /process-image/`: 이미지에서 텍스트 추출 (OCR)
- `POST /generate-questions/`: 문서 내용 기반 FAQ 자동 생성
- `POST /summarization`: 문서 요약 생성
- `POST /faq_answer_model`: FAQ 답변 생성

### 데이터 플로우 (입력 → 처리 → 출력)

**1단계: 파일 업로드 및 감지**
```typescript
// 파일 타입 자동 감지
const detectFileType = (file: File): 'image' | 'document' => {
  const imageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
  return imageTypes.includes(file.type) ? 'image' : 'document';
};
```

**2단계: 문서 파싱 및 청킹**
- **텍스트 청킹**: 500자 단위로 문서를 분할하여 처리
- **이미지 OCR**: 이미지에서 텍스트 추출
- **URL 파싱**: 웹페이지 콘텐츠 추출

**3단계: AI 모델 처리 파이프라인**
1. **문서 요약 생성**: `/summarization` 엔드포인트로 전체 문서 요약
2. **FAQ 질문 생성**: `/generate-questions`로 자주 묻는 질문 자동 생성
3. **답변 생성**: `/faq_answer_model`로 각 질문에 대한 답변 생성

### AI 모델 호출 방식

**비동기 병렬 처리**
```typescript
// HomePage.tsx에서 병렬 처리 예시
allQuestions.forEach(async (item, questionIndex) => {
  const faqResult = await api.generateFaqAnswer(item.question, contextForAnswer);
  // 각 FAQ 답변을 독립적으로 처리
});
```

**오류 처리 및 재시도 로직**
```typescript
// 모델 길이 제한 오류 시 재시도
if (!faqResult.success && (
  faqResult.error?.includes('maximum model length') ||
  faqResult.error?.includes('decoder prompt')
)) {
  contextForAnswer = item.chunkText.substring(0, 300); // 더 짧게 제한
  faqResult = await api.generateFaqAnswer(item.question, contextForAnswer);
}
```

### 문서/이미지 처리 파이프라인

**지원 파일 형식**
```typescript
const SUPPORTED_IMAGE_TYPES = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
const SUPPORTED_DOCUMENT_TYPES = ['application/pdf', 'application/msword', 
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 
  'application/vnd.hancom.hwp'];
const SUPPORTED_TEXT_TYPES = ['text/plain', 'text/markdown'];
```

**파일 크기 제한**
- 이미지: 10MB
- 문서: 50MB  
- 텍스트: 1MB

## 3. 개발 단계별 주요 작업 내용

### 초기 설정 및 기본 구조

**프로젝트 초기화**
- Create React App with TypeScript 템플릿 사용
- 라우터 설정: React Router DOM으로 SPA 구조 구현
- 환경 설정: `.env` 파일로 개발/운영 환경 분리

**폴더 구조 설계**
```
src/
├── components/          # React 컴포넌트
│   ├── HomePage.tsx    # 메인 페이지
│   ├── HomePage.css    # 메인 페이지 스타일
│   ├── DetailPage.tsx  # 상세 페이지
│   └── DetailPage.css  # 상세 페이지 스타일
├── services/           # API 서비스
│   └── api.ts         # 백엔드 API 호출 함수들
├── types/             # TypeScript 타입 정의
│   └── index.ts       # 전체 애플리케이션 타입
├── App.tsx            # 루트 컴포넌트
├── App.css           # 전역 스타일
├── index.tsx         # React 앱 엔트리 포인트
├── index.css         # 기본 CSS 설정
└── setupProxy.js     # CORS 프록시 설정
```

### 컴포넌트 개발 과정

**HomePage.tsx 주요 기능**
1. **멀티모달 입력 지원**:
   - 텍스트 직접 입력
   - 파일 드래그 앤 드롭
   - URL 링크 분석
   - 웹 검색 통합

2. **실시간 상태 관리**:
   ```typescript
   const [loadingState, setLoadingState] = useState<LoadingState>({
     isLoading: false,
     step: '',
     progress: 0,
   });
   ```

3. **추천 콘텐츠 시스템**:
   ```typescript
   const recommendedContents: RecommendedContent[] = [
     {
       id: '1',
       title: '지방재정경제실 민생회복 소비쿠폰 개요',
       description: '지방재정경제실',
       views: 2845,
       type: 'document',
       category: '지원/정책',
       filePath: '/sample-files/민생회복 소비쿠폰 개요 자료.pdf'
     },
     // ...더 많은 추천 콘텐츠
   ];
   ```

**DetailPage.tsx 주요 기능**
1. **FAQ 자동 생성 및 표시**
2. **스마트 AI 채팅 인터페이스**
3. **탭 기반 UI**: FAQ, 쉬운말 변환, 그래픽 요약
4. **실시간 답변 업데이트**

### API 연동 과정

**api.ts 서비스 레이어 구현**
```typescript
// 문서 처리 API 호출 예시
export const processDocumentWithQuestions = async (file: File): Promise<ApiResponse<any>> => {
  const formData = new FormData();
  formData.append('file', file);
  
  let endpoint = '/parse-document/';
  if (file.name.toLowerCase().endsWith('.hwp')) {
    endpoint = '/parse-document-hwp/';
  }
  
  const response = await fetch(`${API_BASE_URL_KINTEL}${endpoint}`, {
    method: 'POST',
    body: formData,
  });
  
  return { success: true, data: await response.json() };
};
```

**CORS 문제 해결**
```javascript
// setupProxy.js - 프록시 미들웨어 설정
const { createProxyMiddleware } = require('http-proxy-middleware');

module.exports = function(app) {
  app.use('/api/kintel', createProxyMiddleware({
    target: 'http://localhost:51037',
    changeOrigin: true,
    pathRewrite: { '^/api/kintel': '' },
  }));
  
  app.use('/api/models', createProxyMiddleware({
    target: 'http://localhost:51036',
    changeOrigin: true,
    pathRewrite: { '^/api/models': '' },
  }));
};
```

**에러 처리 및 사용자 피드백**
```typescript
// 사용자 친화적 에러 메시지
if (errorMessage.includes('HTTP 4') || errorMessage.includes('HTTP 5')) {
  showError(`⚠️ 링크에 접근할 수 없습니다. 올바른 링크인지 확인해주세요.\n링크: ${url}`);
} else if (errorMessage.includes('timeout') || errorMessage.includes('TIMEOUT')) {
  showError(`⏱️ 링크 응답이 너무 오래 걸립니다. 다른 링크를 시도해보세요.\n링크: ${url}`);
}
```

### 데이터 구조 및 타입 정의

**핵심 타입 정의**
```typescript
// 문서 입력 타입
export interface DocumentInput {
  id: string;
  type: 'document' | 'image' | 'link';
  title: string;
  content: string;
  url?: string;
  imageUrl?: string;
  uploadedAt: Date;
  parsedData?: ParsedDocument;
  imageAnalysis?: ProcessedImage;
  generatedQuestions?: GeneratedQuestion[];
  chunkMapping?: { [questionIndex: number]: { chunk_id: string; source: string } };
  summary?: string;
  status?: 'processing' | 'completed' | 'error';
}

// 생성된 질문 타입
export interface GeneratedQuestion {
  question: string;
  answer?: string;
  chunk_id?: string;
  source?: string;
  confidence?: number;
  category?: string;
}
```

**API 응답 표준화**
```typescript
export interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  statusCode?: number;
  timestamp?: string;
}
```

### 주요 기능별 구현 내용

**1. 파일 업로드 및 처리**
- 드래그 앤 드롭 인터페이스
- 파일 타입 자동 감지
- 진행률 표시 및 실시간 상태 업데이트
- 오류 처리 및 사용자 알림

**2. AI 기반 FAQ 생성**
- 문서 청킹 및 전처리
- 비동기 질문 생성
- 답변 품질 향상을 위한 컨텍스트 최적화
- 재시도 로직 구현

**3. 스마트 채팅 시스템**
- 채팅 히스토리 관리
- 동적 로딩 메시지
- 추천 질문 제공
- 실시간 응답 처리

**4. 사용자 경험 최적화**
- 로딩 상태 시각화
- 실시간 알림 시스템
- 키보드 단축키 지원
- 반응형 디자인

## 4. CORS 문제 해결 방안

### 프록시 미들웨어 설정
- `src/setupProxy.js` 파일을 통한 개발 서버 프록시 설정
- 두 개의 백엔드 서버에 대한 별도 프록시 경로 구성
- `changeOrigin: true` 옵션으로 CORS 헤더 문제 해결

### API URL 구조 변경
```typescript
// 기존: 직접 서버 접근 (CORS 오류)
const API_BASE_URL_KINTEL = 'http://localhost:51037';

// 변경: 프록시 경로 사용 (CORS 해결)
const API_BASE_URL_KINTEL = '/api/kintel';
```

## 아키텍처 특징

### 컴포넌트 기반 설계
- **단일 책임 원칙**: 각 컴포넌트는 명확한 역할 분담
- **재사용 가능성**: 타입 안전성을 갖춘 컴포넌트 설계
- **상태 관리**: 로컬 상태와 props를 통한 효율적 데이터 플로우

### 성능 최적화
- **비동기 처리**: Promise 기반 병렬 API 호출
- **청킹 전략**: 대용량 문서의 효율적 처리
- **메모리 관리**: 적절한 상태 초기화 및 정리

### 확장성 고려
- **모듈화된 API 서비스**: 백엔드 변경에 대한 유연성
- **타입 안전성**: TypeScript를 통한 런타임 에러 방지
- **환경별 설정**: `.env` 파일을 통한 설정 관리

## 배포 및 운영 고려사항

### 개발 환경 설정
- React 개발 서버: `localhost:3001`
- Kintel API 서버: `localhost:51037`
- Models API 서버: `localhost:51036`
- 프록시를 통한 CORS 문제 해결

### 운영 환경 고려사항
- API 서버 주소 환경변수 관리
- HTTPS 설정 및 보안 강화
- 로그 모니터링 및 에러 트래킹
- 성능 최적화 및 캐싱 전략

이 프로젝트는 현대적인 React 개발 패턴과 AI 기술을 결합하여, 사용자가 복잡한 공고 문서를 쉽게 이해할 수 있도록 돕는 혁신적인 웹 애플리케이션으로 구현되었습니다.